<Page
  x:Class="BCAudiobookPlayer.Pages.PlaylistPage"
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
  xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
  xmlns:bcAudiobookPlayer="using:BCAudiobookPlayer"
  xmlns:converter="using:BCAudiobookPlayer.Converter"
  xmlns:contract="using:BCAudiobookPlayer.Player.Playback.Contract"
  xmlns:playback="using:BCAudiobookPlayer.Player.Playback"
  xmlns:controls="using:BCAudiobookPlayer.Controls"
  xmlns:pages="using:BCAudiobookPlayer.Pages"
  mc:Ignorable="d"
  Name="Page"
  Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">
  <Page.DataContext>
    <StaticResource ResourceKey="MainPageViewModel" />
  </Page.DataContext>
  <Page.Resources>


    <!--<Style TargetType="ButtonBase">
      <Setter Property="Width"
              Value="48" />
      <Setter Property="Background"
              Value="red" />
      <Setter Property="Height"
              Value="48" />
    </Style>-->

    <x:Double x:Key="ButtonMinWidth">72</x:Double>

    <x:Double x:Key="TextControlThemeMinHeight">32</x:Double>
    <x:Double x:Key="TextControlThemeMinWidth">64</x:Double>
    <x:Double x:Key="TextControlBackgroundRestOpacity">0.4</x:Double>
    <x:Double x:Key="TextControlBackgroundHoverOpacity">0.6</x:Double>
    <x:Double x:Key="TextControlBackgroundFocusedOpacity">1</x:Double>
    <Thickness x:Key="TextControlBorderThemeThickness">2</Thickness>
    <Thickness x:Key="TextControlThemePadding">10,3,6,5</Thickness>
    <Thickness x:Key="ToggleButtonBorderThemeThickness">2</Thickness>

    <Style x:Key="DefaultPlaylistItemStyle"
           TargetType="ListViewItem">
      <Setter Property="IsSelected"
              Value="{Binding IsPlaying}" />
      <Setter Property="BorderThickness"
              Value="0" />
      <Setter Property="BorderBrush"
              Value="{ThemeResource SystemControlBackgroundChromeMediumBrush}" />
      <Setter Property="HorizontalContentAlignment"
              Value="Stretch" />
      <Setter Property="Height"
              Value="256" />
      <Setter Property="Padding"
              Value="16,0" />
      <Setter Property="Margin"
              Value="0,0,0,8" />
      <Setter Property="ContextFlyout">
        <Setter.Value>
          <MenuFlyout>
            <MenuFlyoutItem Text="View Fullscreen" />
            <MenuFlyoutItem Text="Export to .m3u playlist" />
            <MenuFlyoutSeparator />
            <MenuFlyoutItem Text="Play" />
            <MenuFlyoutItem Text="Stop" />
            <MenuFlyoutSeparator />
            <MenuFlyoutItem Text="Remove" />
          </MenuFlyout>
        </Setter.Value>
      </Setter>
    </Style>

    <DataTemplate x:Key="AudiobookChapterJumpListDataTemplate"
                  x:DataType="contract:IAudiobookPart">
      <Grid>
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="Auto" />
          <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>
        <StackPanel Grid.Column="0"
                    Orientation="Horizontal">
          <TextBlock Text="{x:Bind Tag.TrackNumber, Mode=OneWay}"
                     Margin="0,0,0,0"
                     CharacterSpacing="100"
                     ToolTipService.ToolTip="Track Number"
                     MinHeight="0"
                     FontSize="16"
                     FontFamily="Calibri Light"
                     FontWeight="Thin"
                     FontStyle="Normal"
                     FontStretch="UltraExpanded"
                     VerticalAlignment="Center"
                     Foreground="{ThemeResource SystemControlForegroundAccentBrush}" />
          <Image Stretch="UniformToFill"
                 Margin="16,0,0,0"
                 Width="56"
                 Height="56"
                 ToolTipService.ToolTip="Album Art"
                 Source="{x:Bind Tag.CoverArt, Mode=OneWay}" />
        </StackPanel>
        <StackPanel Grid.Column="1"
                    Margin="8,4,0,4">
          <TextBlock Text="{x:Bind Tag.Album, Mode=OneWay}"
                     Margin="0,0,0,0"
                     CharacterSpacing="100"
                     ToolTipService.ToolTip="Album"
                     MinHeight="0"
                     FontSize="13"
                     FontFamily="Book Antiqua"
                     FontWeight="SemiBold"
                     FontStyle="Normal"
                     FontStretch="UltraExpanded" />
          <TextBlock Text="{x:Bind Tag.AlbumArtist, Mode=OneWay}"
                     ToolTipService.ToolTip="Album Artist"
                     FontSize="11"
                     FontFamily="Calibri Light"
                     FontWeight="Thin"
                     FontStyle="Italic"
                     FontStretch="UltraExpanded"
                     Margin="0,-2,0,2" />
          <TextBlock Text="{x:Bind Tag.Title, Mode=OneWay}"
                     ToolTipService.ToolTip="Title"
                     CharacterSpacing="0"
                     FontSize="16"
                     Foreground="{ThemeResource SystemControlForegroundAccentBrush}"
                     FontFamily="Calibri Light"
                     FontWeight="Thin"
                     FontStretch="UltraExpanded"
                     Margin="0,0,0,0" />


        </StackPanel>
      </Grid>
    </DataTemplate>

    <DataTemplate x:Key="BookmarksItemTemplate"
                  x:DataType="playback:IBookmark">
      <Grid>
        <Grid.ContextFlyout>
          <MenuFlyout>
            <MenuFlyoutItem Text="Remove"
                            Click="RemoveBookmark_OnClick" />
          </MenuFlyout>
        </Grid.ContextFlyout>
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="Auto" />
          <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>
        <StackPanel Grid.Column="0"
                    ToolTipService.ToolTip="Position"
                    Orientation="Horizontal">
          <StackPanel Margin="0,0,8,0"
                      VerticalAlignment="Center">
            <TextBlock Text="position"
                       FontSize="10"
                       CharacterSpacing="160"
                       HorizontalAlignment="Left"
                       FontFamily="Calibri Light"
                       FontWeight="Thin"
                       FontStretch="UltraExpanded"
                       Margin="0,0,0,0" />
            <TextBlock Text="{Binding Position, Converter={StaticResource TimeSpanToStringFormatConverter}, ConverterParameter=verbose, Mode=OneWay}"
                       Margin="0,-2,0,0"
                       CharacterSpacing="100"
                       ToolTipService.ToolTip="Hours"
                       MinHeight="0"
                       MinWidth="120"
                       FontSize="16"
                       FontFamily="Calibri Light"
                       FontWeight="Thin"
                       FontStyle="Normal"
                       FontStretch="UltraExpanded"
                       VerticalAlignment="Center"
                       Foreground="{ThemeResource SystemControlForegroundAccentBrush}" />


          </StackPanel>
          <Image Stretch="UniformToFill"
                 Margin="16,0,0,0"
                 Width="56"
                 Height="56"
                 ToolTipService.ToolTip="Album Art"
                 Source="{Binding CoverArt, Mode=OneWay}" />
        </StackPanel>
        <StackPanel Grid.Column="1"
                    Margin="8,4,0,4">
          <TextBlock Text="{x:Bind Album, Mode=OneWay}"
                     Margin="0,0,0,0"
                     CharacterSpacing="100"
                     ToolTipService.ToolTip="Album"
                     MinHeight="0"
                     FontSize="13"
                     FontFamily="Book Antiqua"
                     FontWeight="SemiBold"
                     FontStyle="Normal"
                     FontStretch="UltraExpanded" />
          <TextBlock Text="{x:Bind AlbumArtist, Mode=OneWay}"
                     ToolTipService.ToolTip="Album Artist"
                     FontSize="11"
                     FontFamily="Calibri Light"
                     FontWeight="Thin"
                     FontStyle="Italic"
                     FontStretch="UltraExpanded"
                     Margin="0,0,0,2" />
          <TextBlock Text="{x:Bind Title, Mode=OneWay}"
                     ToolTipService.ToolTip="Title"
                     CharacterSpacing="0"
                     FontSize="16"
                     Foreground="{ThemeResource SystemControlForegroundAccentBrush}"
                     FontFamily="Calibri Light"
                     FontWeight="Thin"
                     FontStretch="UltraExpanded"
                     Margin="0,0,0,0" />


        </StackPanel>
      </Grid>
    </DataTemplate>

    <DataTemplate x:Key="AudioFileDataTemplate"
                  x:DataType="playback:AudioFile">
      <Grid VerticalAlignment="Top"
            Height="256">
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="Auto" />
          <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
          <RowDefinition Height="Auto" />
          <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <Popup x:Name="MessageBox"
               Grid.Row="0"
               Grid.RowSpan="2"
               Grid.Column="0"
               Grid.ColumnSpan="2"
               Margin="0,-56,0,0"
               IsOpen="False"
               IsLightDismissEnabled="False"
               HorizontalAlignment="Center"
               VerticalAlignment="Center">
          <Popup.ChildTransitions>
            <TransitionCollection>
              <PopupThemeTransition />
            </TransitionCollection>
          </Popup.ChildTransitions>
          <Border BorderBrush="{ThemeResource FlyoutBorderThemeBrush}"
                  Background="{StaticResource SystemControlBackgroundAccentBrush}"
                  Opacity="0.8">
            <TextBlock Text="MESSAGE TO YOU FROM ME"
                       FontSize="18"
                       FontStretch="UltraExpanded"
                       CharacterSpacing="200"
                       FontWeight="ExtraLight"
                       Padding="16" />
          </Border>
        </Popup>
        <Image Grid.Row="0"
               Grid.RowSpan="2"
               Stretch="Fill"
               Grid.Column="0"
               Margin="0,0,0,0"
               VerticalAlignment="Top"
               HorizontalAlignment="Left"
               Width="256"
               Height="256"
               Source="{x:Bind Tag.CoverArt, Mode=OneWay}" />
        <StackPanel Grid.Row="0"
                    Grid.Column="1"
                    Margin="32,8,0,0">
          <TextBox Text="{x:Bind Tag.Album, Mode=TwoWay}"
                   Margin="-8,0,0,0"
                   ToolTipService.ToolTip="Album"
                   MinHeight="0"
                   MinWidth="120"
                   FontSize="24"
                   Background="Transparent"
                   FontFamily="Book Antiqua"
                   FontWeight="SemiBold"
                   FontStyle="Normal"
                   FontStretch="UltraExpanded" />
          <StackPanel Orientation="Horizontal"
                      Margin="0,0,0,0">
            <TextBlock Text="by"
                       HorizontalAlignment="Stretch"
                       FontSize="18"
                       Padding="0"
                       Margin="0,-1,0,0"
                       FontFamily="Calibri Light"
                       FontWeight="Thin"
                       FontStyle="Italic"
                       FontStretch="UltraExpanded" />
            <TextBox Text="{x:Bind Tag.AlbumArtist, Mode=TwoWay}"
                     ToolTipService.ToolTip="Album Artist"
                     FontSize="18"
                     MinWidth="120"
                     FontFamily="Calibri Light"
                     FontWeight="Thin"
                     FontStyle="Italic"
                     FontStretch="UltraExpanded"
                     Margin="4,-4,0,0" />
          </StackPanel>
          <TextBox Text="{x:Bind Tag.Title, Mode=TwoWay}"
                   ToolTipService.ToolTip="Title"
                   CharacterSpacing="0"
                   FontSize="32"
                   MinWidth="120"
                   FontFamily="Calibri Light"
                   FontWeight="Thin"
                   FontStretch="UltraExpanded"
                   Margin="-8,4,0,0" />
          <StackPanel Margin="0,4,0,0"
                      Orientation="Horizontal">
            <StackPanel Margin="0,0,16,0">
              <TextBlock Text="track"
                         HorizontalAlignment="Left"
                         FontSize="10"
                         CharacterSpacing="160"
                         FontFamily="Calibri Light"
                         FontWeight="Thin"
                         FontStretch="UltraExpanded"
                         Margin="0,0,0,0" />
              <StackPanel Orientation="Horizontal"
                          Margin="0,0,0,0">
                <TextBlock Text="#"
                           Margin="0,1,0,-1"
                           HorizontalAlignment="Left"
                           FontSize="14"
                           Padding="0"
                           FontFamily="Calibri Light"
                           FontWeight="Thin"
                           FontStyle="Italic"
                           FontStretch="UltraExpanded" />
                <TextBox InputScope="Number"
                         Text="{x:Bind Tag.TrackNumber, Mode=TwoWay, FallbackValue=0}"
                         ToolTipService.ToolTip="Track Number"
                         FontSize="14"
                         MinWidth="30"
                         FontFamily="Calibri Light"
                         FontWeight="Thin"
                         VerticalAlignment="Center"
                         FontStretch="UltraExpanded"
                         Margin="0,0,0,0" />
              </StackPanel>
            </StackPanel>
            <StackPanel Margin="0,0,16,0">
              <TextBlock Text="duration"
                         FontSize="10"
                         CharacterSpacing="160"
                         HorizontalAlignment="Left"
                         FontFamily="Calibri Light"
                         FontWeight="Thin"
                         FontStretch="UltraExpanded"
                         Margin="0,0,0,0" />
              <StackPanel Orientation="Horizontal">
                <TextBlock Text="{x:Bind Duration, Converter={StaticResource TimeSpanToStringFormatConverter}, Mode=OneWay}"
                           FontSize="14"
                           Margin="0,2,0,0"
                           MinWidth="52"
                           FontFamily="Calibri Light"
                           FontWeight="Thin"
                           HorizontalAlignment="Left"
                           VerticalAlignment="Center"
                           FontStretch="UltraExpanded" />
              </StackPanel>
            </StackPanel>
            <StackPanel Margin="0,0,16,0">
              <TextBlock Text="bit rate"
                         FontSize="10"
                         CharacterSpacing="160"
                         FontFamily="Calibri Light"
                         FontWeight="Thin"
                         HorizontalAlignment="Left"
                         FontStretch="UltraExpanded"
                         Margin="0,0,0,0" />
              <TextBlock Text="{x:Bind Tag.BitRate, Converter={StaticResource BitRateToStringConverter}, Mode=OneWay}"
                         FontSize="14"
                         FontFamily="Calibri Light"
                         FontWeight="Thin"
                         HorizontalAlignment="Left"
                         VerticalAlignment="Center"
                         FontStretch="UltraExpanded"
                         Margin="0,2,0,0" />
            </StackPanel>
            <StackPanel Margin="0,0,16,0">
              <TextBlock Text="year"
                         FontSize="10"
                         CharacterSpacing="160"
                         FontFamily="Calibri Light"
                         FontWeight="Thin"
                         HorizontalAlignment="Left"
                         FontStretch="UltraExpanded"
                         Margin="0,0,0,0" />
              <TextBox Text="{x:Bind Tag.Year, Mode=TwoWay, FallbackValue=0}"
                       InputScope="DateYear"
                       ToolTipService.ToolTip="Year"
                       FontSize="14"
                       FontFamily="Calibri Light"
                       FontWeight="Thin"
                       FontStretch="UltraExpanded"
                       Margin="-4,0,0,0" />
            </StackPanel>
            <StackPanel Margin="0,0,16,0">
              <TextBlock Text="genre"
                         FontSize="10"
                         FontFamily="Calibri Light"
                         FontWeight="Thin"
                         CharacterSpacing="160"
                         HorizontalAlignment="Left"
                         FontStretch="UltraExpanded"
                         Margin="0,0,0,0" />
              <TextBox Text="{x:Bind Tag.Genre, Mode=TwoWay}"
                       FontSize="14"
                       ToolTipService.ToolTip="Genre"
                       FontFamily="Calibri Light"
                       FontWeight="Thin"
                       FontStretch="UltraExpanded"
                       Margin="-4,0,0,0" />
            </StackPanel>
            <StackPanel Margin="0,0,16,0">
              <TextBlock Text="rating"
                         FontSize="10"
                         CharacterSpacing="160"
                         HorizontalAlignment="Left"
                         FontFamily="Calibri Light"
                         FontWeight="Thin"
                         FontStretch="UltraExpanded"
                         Margin="0,0,0,0" />

              <RatingControl
                Value="{x:Bind Tag.Rating, Mode=OneWay, Converter={StaticResource RatingConverter}}"
                Margin="0,-4,0,0"
                MaxRating="5"
                HorizontalAlignment="Left"
                VerticalAlignment="Center" />
            </StackPanel>
          </StackPanel>
        </StackPanel>

        <Grid Grid.Row="1"
              Grid.Column="1"
              Margin="32,16,0,0"
              HorizontalAlignment="Stretch"
              VerticalAlignment="Stretch">
          <Grid.ColumnDefinitions>
            <ColumnDefinition Width="Auto" />
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="Auto" />
          </Grid.ColumnDefinitions>
          <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
          </Grid.RowDefinitions>
          <StackPanel Grid.Row="0"
                      Grid.Column="0"
                      Orientation="Horizontal"
                      Margin="0,8,0,0">
            <CommandBar Background="Transparent"
                        OverflowButtonVisibility="Collapsed"
                        Margin="0,-12,8,0">
              <AppBarButton Label="Set Bookmark"
                            Click="SetBookmark_OnClick"
                            CommandParameter="{Binding ElementName=MessageBox}"
                            Width="48"
                            Height="48">
                <AppBarButton.Icon>
                  <FontIcon FontFamily="Segoe MDL2 Assets"
                            Glyph="&#xEC43;" />
                </AppBarButton.Icon>
              </AppBarButton>
            </CommandBar>
            <TextBlock
                Text="{x:Bind CurrentPosition, Converter={StaticResource TimeSpanToStringFormatConverter}, Mode=OneWay}"
                       FontSize="18"
                       MinWidth="80"
                       HorizontalTextAlignment="Justify"
                       HorizontalAlignment="Left"
                       FontFamily="Calibri Light"
                       FontWeight="ExtraLight"
                       VerticalAlignment="Top"
                       FontStretch="UltraExpanded" />
            <TextBlock Text="{x:Bind Duration, Mode=OneWay, Converter={StaticResource TimeSpanToStringFormatConverter}, ConverterParameter=' /'}"
                       FontSize="18"
                       MinWidth="80"
                       HorizontalAlignment="Left"
                       FontFamily="Calibri Light"
                       FontWeight="ExtraLight"
                       VerticalAlignment="Top"
                       FontStretch="UltraExpanded"
                       Margin="0,0,0,0" />
          </StackPanel>
          <StackPanel Grid.Row="0"
                      Grid.Column="1"
                      VerticalAlignment="Stretch"
                      Margin="16,0,16,0">
            <controls:Slider Maximum="{x:Bind Duration, Converter={StaticResource PlaybackProgressConverter}, Mode=OneWay}"
                             Value="{Binding CurrentPosition, Converter={StaticResource PlaybackProgressConverter}, Mode=OneWay}"
                             Minimum="0"
                             StepFrequency="1"
                             HorizontalAlignment="Stretch"
                             HorizontalContentAlignment="Stretch"
                             ThumbToolTipValueConverter="{StaticResource PlaybacksProgressToDurationConverter}"
                             VerticalAlignment="Stretch"
                             controls:SliderDragCompleted="JumpToPosition_OnDragCompleted" />
            <CommandBar Margin="0,0,0,0"
                        IsDynamicOverflowEnabled="True"
                        Background="Transparent"
                        HorizontalAlignment="Center"
                        OverflowButtonVisibility="Collapsed">
              <AppBarToggleButton x:Name="PlaybackButton"
                                  Width="48"
                                  Click="PlayFile"
                                  Label="Play"
                                  CommandParameter="{x:Bind}"
                                  Icon="{x:Bind IsPlaying, Converter={StaticResource PlayImageToggleConverter}, Mode=OneWay}">

              </AppBarToggleButton>

              <AppBarButton Label="Stop"
                            Click="StopFile"
                            Width="48"
                            CommandParameter="{x:Bind Mode=OneWay}"
                            Icon="Stop" />

              <AppBarButton Label="Previous"
                            Width="48"
                            Margin="32,1,1,0"
                            Click="SkipFileBack"
                            CommandParameter="{x:Bind Mode=OneWay}"
                            Icon="Previous" />

              <AppBarButton Label="Next"
                            Width="48"
                            Click="SkipFileForward"
                            CommandParameter="{x:Bind Mode=OneWay}"
                            Icon="Next" />
              <AppBarSeparator />
              <AppBarToggleButton Width="48"
                                  Margin="1"
                                  IsChecked="{x:Bind IsLoopEnabled, Mode=TwoWay}"
                                  CommandParameter="{x:Bind Mode=OneWay}">
                <AppBarToggleButton.Icon>
                  <FontIcon Glyph="&#xEF3B;" />
                </AppBarToggleButton.Icon>
              </AppBarToggleButton>
              <AppBarToggleButton Label="Loop Begin"
                                  Width="48"
                                  Click="SetRepeatStartTime_OnClick"
                                  CommandParameter="{x:Bind Mode=OneWay}">
                <AppBarToggleButton.Icon>
                  <FontIcon FontFamily="{ThemeResource SymbolThemeFontFamily}"
                            Glyph="&#xE819;" />
                </AppBarToggleButton.Icon>
              </AppBarToggleButton>
              <AppBarToggleButton Label="Loop End"
                                  Width="48"
                                  Click="SetRepeatStopTime_OnClick"
                                  CommandParameter="{x:Bind Mode=OneWay}">
                <AppBarToggleButton.Icon>
                  <FontIcon Glyph="&#xE81A;" />
                </AppBarToggleButton.Icon>
              </AppBarToggleButton>
              <AppBarSeparator Margin="1" />
              <AppBarButton Width="48">
                <AppBarButton.Icon>
                  <FontIcon Glyph="&#xE7BC;" />
                </AppBarButton.Icon>
                <AppBarButton.Flyout>
                  <Flyout Placement="Left">
                    <Grid>
                      <ListView ItemsSource="{x:Bind Bookmarks, Mode=OneWay}"
                                ItemTemplate="{StaticResource BookmarksItemTemplate}"
                                IsItemClickEnabled="True"
                                ItemClick="PlayBookmark_OnClick">
                        <ListView.Header>
                          <Border Background="{ThemeResource SystemControlBackgroundAccentBrush}"
                                  Padding="16,12,16,0"
                                  Margin="0,0,0,4">
                            <TextBlock Text="Bookmarks"
                                       CharacterSpacing="80"
                                       Height="56"
                                       TextWrapping="WrapWholeWords"
                                       FontSize="36"
                                       FontFamily="Calibri Light"
                                       FontWeight="Thin"
                                       FontStretch="UltraExpanded"
                                       HorizontalAlignment="Left" />
                          </Border>
                        </ListView.Header>
                      </ListView>
                    </Grid>
                  </Flyout>
                </AppBarButton.Flyout>
              </AppBarButton>
            </CommandBar>
          </StackPanel>
          <StackPanel Grid.Row="0"
                      Grid.Column="2"
                      Orientation="Horizontal">
            <TextBlock
              Text="{x:Bind TimeRemaining, Mode=TwoWay, Converter={StaticResource TimeSpanToStringFormatConverter}, ConverterParameter=-}"
              FontSize="18"
              FontFamily="Calibri Light"
              FontWeight="Thin"
              HorizontalAlignment="Left"
              VerticalAlignment="Top"
              FontStretch="UltraExpanded"
              MinWidth="68"
              HorizontalTextAlignment="Justify"
              Margin="0,8,0,0" />

            <CommandBar Background="Transparent"
                        VerticalAlignment="Top"
                        OverflowButtonVisibility="Collapsed"
                        Margin="0,-4,0,0">
              <AppBarButton x:Name="MainVolumeButton"
                            Label="Volume"
                            Margin="8,0,0,0"
                            Width="48"
                            VerticalAlignment="Center"
                            Icon="{x:Bind Volume, Converter={StaticResource VolumeImageToggleConverter}, Mode=OneWay}">
                <AppBarButton.Flyout>
                  <Flyout>
                    <StackPanel Orientation="Horizontal">

                      <CommandBar Padding="0"
                                  Background="Transparent"
                                  OverflowButtonVisibility="Collapsed">
                        <AppBarToggleButton Label="Volume"
                                            Width="48"
                                            IsChecked="{x:Bind IsMuted, Mode=TwoWay}"
                                            Icon="{x:Bind Volume, Converter={StaticResource VolumeImageToggleConverter}, Mode=OneWay}" />
                      </CommandBar>
                      <controls:Slider Maximum="1.0"
                              Value="{x:Bind Volume, Mode=TwoWay}"
                              Minimum="0.0"
                              StepFrequency="0.01"
                              TickFrequency="0.25"
                              TickPlacement="Outside"
                              ThumbToolTipValueConverter="{StaticResource PercentageFormatConverter}"
                              Margin="8,8,16,0"
                              Width="200"
                              Padding="0"
                              Height="Auto"
                              VerticalAlignment="Center" />
                    </StackPanel>
                  </Flyout>
                </AppBarButton.Flyout>
              </AppBarButton>
            </CommandBar>
          </StackPanel>
        </Grid>
        <Button Grid.Row="0"
                Grid.Column="1"
                ToolTipService.ToolTip="Remove audiobook from playlist"
                Margin="0,8,0,0"
                Style="{ThemeResource ButtonRevealStyle}"
                Width="48"
                BorderThickness="1"
                Background="Transparent"
                VerticalAlignment="Top"
                HorizontalAlignment="Right"
                Height="48"
                CommandParameter="{x:Bind Mode=OneWay}"
                Click="RemovePartFromPlaylist_OnClick">
          <Button.Content>
            <SymbolIcon Symbol="Clear" />
          </Button.Content>
        </Button>
      </Grid>
    </DataTemplate>

    <DataTemplate x:Key="AudiobookDataTemplate"
                  x:DataType="playback:Audiobook">
      <Grid VerticalAlignment="Top"
            Height="256">
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="Auto" />
          <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
          <RowDefinition Height="Auto" />
          <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <Popup x:Name="MessageBox"
               Grid.Row="0"
               Grid.RowSpan="2"
               Grid.Column="0"
               Grid.ColumnSpan="2"
               Margin="0,-56,0,0"
               IsOpen="False"
               IsLightDismissEnabled="False"
               HorizontalAlignment="Center"
               VerticalAlignment="Center">
          <Popup.ChildTransitions>
            <TransitionCollection>
              <PopupThemeTransition />
            </TransitionCollection>
          </Popup.ChildTransitions>
          <Border BorderBrush="{ThemeResource FlyoutBorderThemeBrush}"
                  Background="{StaticResource SystemControlBackgroundAccentBrush}"
                  Opacity="0.8">
            <TextBlock Text="MESSAGE TO YOU FROM ME"
                       FontSize="18"
                       FontStretch="UltraExpanded"
                       CharacterSpacing="200"
                       FontWeight="ExtraLight"
                       Padding="16" />
          </Border>
        </Popup>

        <Image Grid.Row="0"
               Grid.RowSpan="2"
               Stretch="Fill"
               Grid.Column="0"
               Margin="0,0,0,0"
               VerticalAlignment="Top"
               HorizontalAlignment="Left"
               Width="256"
               Height="256"
               Source="{x:Bind CurrentPart.Tag.CoverArt, Mode=OneWay}" />
        <StackPanel Grid.Row="0"
                    Grid.Column="1"
                    Margin="32,8,0,0">
          <TextBox Text="{x:Bind CurrentPart.Tag.Album, Mode=TwoWay}"
                   Margin="-8,0,0,0"
                   ToolTipService.ToolTip="Album"
                   MinHeight="0"
                   MinWidth="120"
                   FontSize="24"
                   Background="Transparent"
                   FontFamily="Book Antiqua"
                   FontWeight="SemiBold"
                   FontStyle="Normal"
                   FontStretch="UltraExpanded" />
          <StackPanel Orientation="Horizontal"
                      Margin="0,0,0,0">
            <TextBlock Text="by"
                       HorizontalAlignment="Stretch"
                       FontSize="18"
                       Padding="0"
                       Margin="0,-1,0,0"
                       FontFamily="Calibri Light"
                       FontWeight="Thin"
                       FontStyle="Italic"
                       FontStretch="UltraExpanded" />
            <TextBox Text="{x:Bind CurrentPart.Tag.AlbumArtist, Mode=TwoWay}"
                     ToolTipService.ToolTip="Album Artist"
                     FontSize="18"
                     MinWidth="120"
                     FontFamily="Calibri Light"
                     FontWeight="Thin"
                     FontStyle="Italic"
                     FontStretch="UltraExpanded"
                     Margin="4,-4,0,0" />
          </StackPanel>
          <TextBox Text="{x:Bind CurrentPart.Tag.Title, Mode=TwoWay}"
                   ToolTipService.ToolTip="Title"
                   CharacterSpacing="0"
                   FontSize="32"
                   MinWidth="120"
                   FontFamily="Calibri Light"
                   FontWeight="Thin"
                   FontStretch="UltraExpanded"
                   Margin="-8,4,0,0" />
          <StackPanel Margin="0,4,0,0"
                      Orientation="Horizontal">
            <StackPanel Margin="0,0,16,0">
              <TextBlock Text="track"
                         HorizontalAlignment="Left"
                         FontSize="10"
                         CharacterSpacing="160"
                         FontFamily="Calibri Light"
                         FontWeight="Thin"
                         FontStretch="UltraExpanded"
                         Margin="0,0,0,0" />
              <StackPanel Orientation="Horizontal"
                          Margin="0,0,0,0">
                <TextBlock Text="#"
                           Margin="0,3,0,-1"
                           HorizontalAlignment="Left"
                           FontSize="14"
                           Padding="0"
                           FontFamily="Calibri Light"
                           FontWeight="Thin"
                           FontStyle="Italic"
                           FontStretch="UltraExpanded" />
                <TextBox InputScope="Number"
                         Text="{x:Bind CurrentPart.Tag.TrackNumber, Mode=TwoWay, FallbackValue=0}"
                         ToolTipService.ToolTip="Track Number"
                         FontSize="14"
                         MinWidth="30"
                         FontFamily="Calibri Light"
                         FontWeight="Thin"
                         VerticalAlignment="Center"
                         FontStretch="UltraExpanded"
                         Margin="0,0,0,0" />
              </StackPanel>
            </StackPanel>
            <StackPanel Margin="0,0,16,0">
              <TextBlock Text="position"
                         FontSize="10"
                         CharacterSpacing="160"
                         HorizontalAlignment="Left"
                         FontFamily="Calibri Light"
                         FontWeight="Thin"
                         FontStretch="UltraExpanded"
                         Margin="0,0,0,0" />

              <TextBlock
                Text="{x:Bind CurrentPart.CurrentPosition, Converter={StaticResource TimeSpanToStringFormatConverter}, Mode=OneWay}"
                FontSize="14"
                Margin="0,2,0,0"
                MinWidth="52"
                FontFamily="Calibri Light"
                FontWeight="Thin"
                HorizontalAlignment="Left"
                VerticalAlignment="Center"
                FontStretch="UltraExpanded" />
            </StackPanel>
            <StackPanel Margin="0,0,16,0">
              <TextBlock Text="duration"
                         FontSize="10"
                         CharacterSpacing="160"
                         HorizontalAlignment="Left"
                         FontFamily="Calibri Light"
                         FontWeight="Thin"
                         FontStretch="UltraExpanded"
                         Margin="0,0,0,0" />
              <StackPanel Orientation="Horizontal">
                <!--<TextBlock
                    Text="{x:Bind CurrentPart.CurrentPosition, Converter={StaticResource TimeSpanToStringFormatConverter}}"
                           FontSize="14"
                           Margin="0,0,0,0"
                  MinWidth="52"
                           FontFamily="Calibri Light"
                           FontWeight="Thin"
                  HorizontalTextAlignment="Justify"
                           VerticalAlignment="Center"
                           FontStretch="UltraExpanded" />
                <TextBlock Text="/"
                           FontSize="14"
                           Margin="2,0"
                           FontFamily="Calibri Light"
                           FontWeight="Thin"
                           HorizontalAlignment="Left"
                           VerticalAlignment="Center"
                           FontStretch="UltraExpanded" />-->
                <TextBlock
                    Text="{x:Bind CurrentPart.Duration, Converter={StaticResource TimeSpanToStringFormatConverter}, Mode=OneWay}"
                           FontSize="14"
                           Margin="0,2,0,0"
                           MinWidth="52"
                           FontFamily="Calibri Light"
                           FontWeight="Thin"
                           HorizontalAlignment="Left"
                           VerticalAlignment="Center"
                           FontStretch="UltraExpanded" />
              </StackPanel>
            </StackPanel>
            <StackPanel Margin="0,0,16,0">
              <TextBlock Text="bit rate"
                         FontSize="10"
                         CharacterSpacing="160"
                         FontFamily="Calibri Light"
                         FontWeight="Thin"
                         HorizontalAlignment="Left"
                         FontStretch="UltraExpanded"
                         Margin="0,0,0,0" />
              <TextBlock Text="{x:Bind CurrentPart.Tag.BitRate, Converter={StaticResource BitRateToStringConverter}, Mode=OneWay}"
                         FontSize="14"
                         FontFamily="Calibri Light"
                         FontWeight="Thin"
                         HorizontalAlignment="Left"
                         VerticalAlignment="Center"
                         FontStretch="UltraExpanded"
                         Margin="0,2,0,0" />
            </StackPanel>
            <StackPanel Margin="0,0,16,0">
              <TextBlock Text="year"
                         FontSize="10"
                         CharacterSpacing="160"
                         FontFamily="Calibri Light"
                         FontWeight="Thin"
                         HorizontalAlignment="Left"
                         FontStretch="UltraExpanded"
                         Margin="0,0,0,0" />
              <TextBox Text="{x:Bind CurrentPart.Tag.Year, Mode=TwoWay, FallbackValue=0}"
                       InputScope="DateYear"
                       ToolTipService.ToolTip="Year"
                       FontSize="14"
                       FontFamily="Calibri Light"
                       FontWeight="Thin"
                       FontStretch="UltraExpanded"
                       Margin="-4,0,0,0" />
            </StackPanel>
            <StackPanel Margin="0,0,16,0">
              <TextBlock Text="genre"
                         FontSize="10"
                         FontFamily="Calibri Light"
                         FontWeight="Thin"
                         CharacterSpacing="160"
                         HorizontalAlignment="Left"
                         FontStretch="UltraExpanded"
                         Margin="0,0,0,0" />
              <TextBox Text="{x:Bind CurrentPart.Tag.Genre, Mode=TwoWay}"
                       FontSize="14"
                       ToolTipService.ToolTip="Genre"
                       FontFamily="Calibri Light"
                       FontWeight="Thin"
                       FontStretch="UltraExpanded"
                       Margin="-4,0,0,0" />
            </StackPanel>
            <StackPanel Margin="0,0,16,0">
              <TextBlock Text="rating"
                         FontSize="10"
                         CharacterSpacing="160"
                         HorizontalAlignment="Left"
                         FontFamily="Calibri Light"
                         FontWeight="Thin"
                         FontStretch="UltraExpanded"
                         Margin="0,0,0,0" />

              <RatingControl 
                Value="{x:Bind CurrentPart.Tag.Rating, Mode=OneWay, Converter={StaticResource RatingConverter}}"
                Margin="0,-4,0,0"
                MaxRating="5" 
                HorizontalAlignment="Left"
                VerticalAlignment="Center" />
            </StackPanel>
          </StackPanel>
        </StackPanel>

        <Grid Grid.Row="1"
              Grid.Column="1"
              Margin="32,16,0,0"
              HorizontalAlignment="Stretch"
              VerticalAlignment="Stretch">
          <Grid.ColumnDefinitions>
            <ColumnDefinition Width="Auto" />
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="Auto" />
          </Grid.ColumnDefinitions>
          <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
          </Grid.RowDefinitions>
          <StackPanel Grid.Row="0"
                      Grid.Column="0"
                      Orientation="Horizontal"
                      Margin="0,8,0,0">
            <CommandBar Background="Transparent"
                        OverflowButtonVisibility="Collapsed"
                        Margin="0,-12,8,0">
              <AppBarButton Click="SetBookmark_OnClick"
                            ToolTipService.ToolTip="Set bookmark"
                            CommandParameter="{Binding ElementName=MessageBox}"
                            VerticalAlignment="Center"
                            Padding="0"
                            IsCompact="True"
                            Margin="0,-2,0,0"
                            Width="48"
                            Height="48">
                <AppBarButton.Icon>
                  <FontIcon FontFamily="{ThemeResource SymbolThemeFontFamily}"
                            Glyph="&#xEC43;"
                            Margin="0,0,0,0" />

                </AppBarButton.Icon>
              </AppBarButton>
            </CommandBar>
            <StackPanel>
              <StackPanel Orientation="Horizontal">
                <TextBlock
                    Text="{x:Bind CurrentPosition, Mode=OneWay, Converter={StaticResource TimeSpanToStringFormatConverter}}"
                  FontSize="18"
                  FontFamily="Calibri Light"
                  FontWeight="Thin"
                  HorizontalAlignment="Left"
                  VerticalAlignment="Top"
                  FontStretch="UltraExpanded"
                  MinWidth="96"
                  HorizontalTextAlignment="Justify"
                  Margin="0,-4,0,0" />
                <TextBlock
                    Text="{x:Bind Duration, Mode=OneWay, Converter={StaticResource TimeSpanToStringFormatConverter}, ConverterParameter='/'}"
                  FontSize="18"
                  FontFamily="Calibri Light"
                  FontWeight="Thin"
                  HorizontalAlignment="Left"
                  VerticalAlignment="Top"
                  FontStretch="UltraExpanded"
                  MinWidth="96"
                  HorizontalTextAlignment="Justify"
                  Margin="0,-4,0,0" />

                
              </StackPanel>
              <TextBlock x:Name="TextBlock"
                           converter:CurrentTrackToTrackSummaryConverter.Audiobook="{x:Bind Mode=OneWay}"
                           Text="{x:Bind Converter={StaticResource CurrentTrackToTrackSummaryConverter}, Mode=OneWay}"
                           HorizontalAlignment="Left"
                           FontSize="12"
                           FontFamily="Calibri Light"
                           FontWeight="Thin"
                           VerticalAlignment="Center"
                           Margin="0,0,16,0"
                           FontStretch="UltraExpanded" />
            </StackPanel>
          </StackPanel>
          <StackPanel Grid.Row="0"
                      Grid.Column="1"
                      VerticalAlignment="Stretch"
                      Margin="16,0,16,0">
            <controls:Slider Maximum="{x:Bind Duration, Converter={StaticResource PlaybackProgressConverter}, Mode=OneWay}"
                             Value="{Binding CurrentPosition, Converter={StaticResource PlaybackProgressConverter}, Mode=OneWay}"
                             Minimum="0"
                             StepFrequency="1"
                             HorizontalAlignment="Stretch"
                             HorizontalContentAlignment="Stretch"
                             ThumbToolTipValueConverter="{StaticResource PlaybacksProgressToDurationConverter}"
                             VerticalAlignment="Stretch"
                             controls:SliderDragCompleted="JumpToPosition_OnDragCompleted" />
            <CommandBar Margin="0,0,0,0"
                        IsDynamicOverflowEnabled="True"
                        Background="Transparent"
                        HorizontalAlignment="Center"
                        OverflowButtonVisibility="Collapsed">
              <AppBarToggleButton x:Name="PlaybackButton"
                                  Width="48"
                                  Click="PlayFile"
                                  Label="Play"
                                  IsChecked="{x:Bind IsPlaying, Mode=TwoWay}"
                                  CommandParameter="{x:Bind Mode=OneWay}"
                                  Icon="{x:Bind IsPlaying, Converter={StaticResource PlayImageToggleConverter}, Mode=OneWay}">

              </AppBarToggleButton>

              <AppBarButton Label="Stop"
                            Click="StopFile"
                            Width="48"
                            CommandParameter="{x:Bind Mode=OneWay}"
                            Icon="Stop" />

              <AppBarButton Label="Previous"
                            Width="48"
                            Margin="32,1,1,0"
                            Click="SkipFileBack"
                            CommandParameter="{x:Bind Mode=OneWay}"
                            Icon="Previous" />

              <AppBarButton Label="Next"
                            Width="48"
                            Click="SkipFileForward"
                            CommandParameter="{x:Bind Mode=OneWay}"
                            Icon="Next" />
              <AppBarSeparator />
              <AppBarButton Label="Seek Forward"
                            Width="48"
                            Height="48"
                            Click="SeekBackward"
                            CommandParameter="{x:Bind Mode=OneWay}">
                <AppBarButton.Icon>
                  <FontIcon FontFamily="{ThemeResource SymbolThemeFontFamily}"
                            Glyph="&#xED3C;" />
                </AppBarButton.Icon>
              </AppBarButton>
              <AppBarSeparator />
              <AppBarToggleButton Width="48"
                                  Margin="1"
                                  IsChecked="{x:Bind IsLoopEnabled, Mode=TwoWay}"
                                  CommandParameter="{x:Bind Mode=OneWay}">
                <AppBarToggleButton.Icon>
                  <FontIcon Glyph="&#xEF3B;" />
                </AppBarToggleButton.Icon>
              </AppBarToggleButton>
              <AppBarToggleButton Label="Loop Begin"
                                  Width="48"
                                  Click="SetRepeatStartTime_OnClick"
                                  CommandParameter="{x:Bind Mode=OneWay}">
                <AppBarToggleButton.Icon>
                  <FontIcon FontFamily="{ThemeResource SymbolThemeFontFamily}"
                            Glyph="&#xE819;" />
                </AppBarToggleButton.Icon>
              </AppBarToggleButton>
              <AppBarToggleButton Label="Loop End"
                                  Width="48"
                                  Click="SetRepeatStopTime_OnClick"
                                  CommandParameter="{x:Bind Mode=OneWay}">
                <AppBarToggleButton.Icon>
                  <FontIcon Glyph="&#xE81A;" />
                </AppBarToggleButton.Icon>
              </AppBarToggleButton>
              <AppBarSeparator Margin="1" />
              <AppBarButton Width="48">
                <AppBarButton.Icon>
                  <FontIcon Glyph="&#xE7BC;" />
                </AppBarButton.Icon>
                <AppBarButton.Flyout>
                  <Flyout Placement="Left">
                    <Grid>
                      <ListView ItemsSource="{x:Bind Bookmarks, Mode=OneWay}"
                                ItemTemplate="{StaticResource BookmarksItemTemplate}"
                                IsItemClickEnabled="True"
                                ItemClick="PlayBookmark_OnClick">
                        <ListView.Header>
                          <Border Background="{ThemeResource SystemControlBackgroundAccentBrush}"
                                  Padding="16,12,16,0"
                                  Margin="0,0,0,4">
                            <TextBlock Text="Bookmarks"
                                       CharacterSpacing="80"
                                       Height="56"
                                       TextWrapping="WrapWholeWords"
                                       FontSize="36"
                                       FontFamily="Calibri Light"
                                       FontWeight="Thin"
                                       FontStretch="UltraExpanded"
                                       HorizontalAlignment="Left" />
                          </Border>
                        </ListView.Header>
                      </ListView>
                    </Grid>
                  </Flyout>
                </AppBarButton.Flyout>
              </AppBarButton>
            </CommandBar>
          </StackPanel>
          <StackPanel Grid.Row="0"
                      Grid.Column="2"
                      Orientation="Horizontal">
            <TextBlock
                Text="{x:Bind TimeRemaining, Mode=OneWay, Converter={StaticResource TimeSpanToStringFormatConverter}, ConverterParameter=-}"
                       FontSize="18"
                       FontFamily="Calibri Light"
                       FontWeight="Thin"
                       HorizontalAlignment="Left"
                       VerticalAlignment="Top"
                       FontStretch="UltraExpanded"
                       MinWidth="96"
                       HorizontalTextAlignment="Justify"
                       Margin="0,4,0,0" />

            <CommandBar Background="Transparent"
                        VerticalAlignment="Top"
                        OverflowButtonVisibility="Collapsed"
                        Margin="0,-4,0,0">
              <AppBarButton x:Name="MainVolumeButton"
                            Label="Volume"
                            Margin="8,-2,0,0"
                            Width="48"
                            VerticalAlignment="Center"
                            Icon="{x:Bind Volume, Converter={StaticResource VolumeImageToggleConverter}, Mode=OneWay}">
                <AppBarButton.Flyout>
                  <Flyout>
                    <StackPanel Orientation="Horizontal">

                      <CommandBar Padding="0"
                                  Background="Transparent"
                                  OverflowButtonVisibility="Collapsed">
                        <AppBarToggleButton Label="Volume"
                                            Width="48"
                                            IsChecked="{Binding IsMuted, Mode=TwoWay}"
                                            Icon="{x:Bind Volume, Converter={StaticResource VolumeImageToggleConverter}, Mode=OneWay}" />
                      </CommandBar>
                      <controls:Slider Maximum="1.0"
                              Value="{Binding Volume, Mode=TwoWay}" ManipulationCompleted="UIElement_OnManipulationCompleted"
                              Minimum="0.0"
                              StepFrequency="0.01"
                              TickFrequency="0.25"
                              TickPlacement="Outside"
                              ThumbToolTipValueConverter="{StaticResource PercentageFormatConverter}"
                              Margin="8,0,16,0"
                              Width="200"
                              Padding="0"
                              Height="Auto"
                              VerticalAlignment="Center" />
                    </StackPanel>
                  </Flyout>
                </AppBarButton.Flyout>
              </AppBarButton>
            </CommandBar>
          </StackPanel>
        </Grid>

        <StackPanel Grid.Row="0"
                    Grid.RowSpan="2"
                    Grid.ColumnSpan="2"
                    Grid.Column="0"
                    Margin="0,8,0,0"
                    Orientation="Horizontal"
                    VerticalAlignment="Top"
                    HorizontalAlignment="Right"
                    Background="Transparent">
          <Button ToolTipService.ToolTip="Auto set/ complete media tags"
                  Style="{ThemeResource ButtonRevealStyle}"
                  Width="48"
                  BorderThickness="1"
                  Background="Transparent"
                  Height="48"
                  CommandParameter="{x:Bind Mode=OneWay}"
                  Click="AutoTagAudiobookPart_OnClick">
            <Button.Content>
              <SymbolIcon Symbol="Tag" />
            </Button.Content>
          </Button>
          <Button Style="{ThemeResource ButtonRevealStyle}"
                  ToolTipService.ToolTip="Jump to chapter"
                  Width="48"
                  Height="48"
                  BorderThickness="1"
                  Background="Transparent">
            <Button.Content>
              <SymbolIcon Symbol="Bookmarks" />
            </Button.Content>
            <Button.Flyout>
              <Flyout Placement="Left">
                <Grid>
                  <ListView ItemsSource="{x:Bind Parts, Converter={StaticResource AudiobookPartsToChapterListConverter}, Mode=OneWay}"
                            ItemTemplate="{StaticResource AudiobookChapterJumpListDataTemplate}"
                            IsItemClickEnabled="True"
                            DataFetchSize="2"
                            IncrementalLoadingThreshold="10"
                            ItemClick="JumpToAudiobookChapter_OnClick">
                    <ListView.Header>
                      <Border Background="{ThemeResource SystemControlBackgroundAccentBrush}"
                              Padding="16,12,16,0"
                              Margin="0,0,0,4">
                        <TextBlock Text="Chapters"
                                   CharacterSpacing="80"
                                   Height="56"
                                   TextWrapping="WrapWholeWords"
                                   FontSize="36"
                                   FontFamily="Calibri Light"
                                   FontWeight="Thin"
                                   FontStretch="UltraExpanded"
                                   HorizontalAlignment="Left" />
                      </Border>
                    </ListView.Header>
                  </ListView>
                </Grid>
              </Flyout>
            </Button.Flyout>
          </Button>
          <Button ToolTipService.ToolTip="Remove audiobook from playlist"
                  Style="{ThemeResource ButtonRevealStyle}"
                  Width="48"
                  BorderThickness="1"
                  Background="Transparent"
                  Height="48"
                  CommandParameter="{x:Bind Mode=OneWay}"
                  Click="RemovePartFromPlaylist_OnClick">
            <Button.Content>
              <SymbolIcon Symbol="Clear" />
            </Button.Content>
          </Button>
        </StackPanel>
        <ProgressBar Grid.Row="0"
                     Grid.Column="0"
                     Grid.ColumnSpan="2"
                     IsIndeterminate="True"
                     VerticalAlignment="Top"
                     Visibility="{x:Bind IsCreating, Converter={StaticResource BooleanToVisibilityConverter}, Mode=OneWay}" />
      </Grid>
    </DataTemplate>

    <DataTemplate x:Key="HttpStreamDataTemplate"
                  x:DataType="contract:IHttpMediaStream">
      <Grid>
        <StackPanel Orientation="Horizontal">
          <WebView Loaded="ShowWebContent"
                   VerticalAlignment="Top"
                   HorizontalAlignment="Left"
                   Height="256"
                   Width="336"
                   DefaultBackgroundColor="Transparent"
                   IsHitTestVisible="False"
                   UseLayoutRounding="True" />
          <TextBox x:Name="HttpStreamTitleTextBox"
                   Text="{x:Bind Tag.Title, Mode=TwoWay}"
                   PlaceholderText="enter a title"
                   ToolTipService.ToolTip="Title"
                   CharacterSpacing="0"
                   FontSize="32"
                   HorizontalAlignment="Left"
                   FontFamily="Calibri Light"
                   FontWeight="Thin"
                   FontStretch="UltraExpanded"
                   VerticalAlignment="Top"
                   MaxWidth="720"
                   TextWrapping="Wrap"
                   Padding="16,8,16,0"
                   Margin="32,40,0,0" />
        </StackPanel>
        <Button ToolTipService.ToolTip="Remove audiobook from playlist"
                Margin="0,8,0,0"
                Style="{ThemeResource ButtonRevealStyle}"
                Width="48"
                VerticalAlignment="Top"
                HorizontalAlignment="Right"
                BorderThickness="1"
                Background="Transparent"
                Height="48"
                CommandParameter="{x:Bind Mode=OneWay}"
                Click="RemovePartFromPlaylist_OnClick">
          <Button.Content>
            <SymbolIcon Symbol="Clear" />
          </Button.Content>
        </Button>
      </Grid>
    </DataTemplate>

    <bcAudiobookPlayer:PlaylistTemplateSelector x:Key="PlaylistTemplateSelector"
                                                AudiobookDataTemplate="{StaticResource AudiobookDataTemplate}"
                                                AudioFileDataTemplate="{StaticResource AudioFileDataTemplate}"
                                                HttpMediaStreamDataTemplate="{StaticResource HttpStreamDataTemplate}" />


    <!-- Default style for Windows.UI.Xaml.Controls.Primitives.ToggleButton -->
    <Style x:Key="PlaybackButtonToggleButtonStyle"
           TargetType="ToggleButton">
      <!--<Setter Property="Background"
              Value="{ThemeResource SystemControlBackgroundBaseLowBrush}" />-->
      <Setter Property="Background"
              Value="Transparent" />
      <Setter Property="MinWidth"
              Value="{ThemeResource ButtonMinWidth}" />
      <Setter Property="Foreground"
              Value="{ThemeResource SystemControlForegroundBaseHighBrush}" />
      <Setter Property="BorderBrush"
              Value="{ThemeResource SystemControlForegroundTransparentBrush}" />
      <Setter Property="BorderThickness"
              Value="{ThemeResource ToggleButtonBorderThemeThickness}" />
      <Setter Property="Padding"
              Value="8,4,8,4" />
      <Setter Property="HorizontalAlignment"
              Value="Left" />
      <Setter Property="VerticalAlignment"
              Value="Center" />
      <Setter Property="FontFamily"
              Value="{ThemeResource ContentControlThemeFontFamily}" />
      <Setter Property="FontWeight"
              Value="Normal" />
      <Setter Property="FontSize"
              Value="{ThemeResource ControlContentThemeFontSize}" />
      <Setter Property="UseSystemFocusVisuals"
              Value="True" />
      <Setter Property="Template">
        <Setter.Value>
          <ControlTemplate TargetType="ToggleButton">
            <Grid x:Name="RootGrid"
                  Background="{TemplateBinding Background}">
              <VisualStateManager.VisualStateGroups>
                <VisualStateGroup x:Name="CommonStates">
                  <VisualState x:Name="Normal">
                    <Storyboard>
                      <!--<ObjectAnimationUsingKeyFrames Storyboard.TargetName="ContentPresenter"
                                                     Storyboard.TargetProperty="Content">
                        <DiscreteObjectKeyFrame KeyTime="0:0:0">
                          <DiscreteObjectKeyFrame.Value>
                            <Image x:Name="PlayIcon"
                                   ImageFailed="PauseIcon_OnImageFailed"
                                   Source="Assets/play-button_dark.svg"
                                   Stretch="Uniform" />
                          </DiscreteObjectKeyFrame.Value>
                        </DiscreteObjectKeyFrame>
                      </ObjectAnimationUsingKeyFrames>-->
                      <PointerUpThemeAnimation Storyboard.TargetName="RootGrid" />
                    </Storyboard>
                  </VisualState>
                  <VisualState x:Name="PointerOver">
                    <Storyboard>
                      <!--<ObjectAnimationUsingKeyFrames Storyboard.TargetName="ContentPresenter"
                                                     Storyboard.TargetProperty="Content">
                        <DiscreteObjectKeyFrame KeyTime="0">
                          <DiscreteObjectKeyFrame.Value>
                            <x:Bind local:ImageToggleConverter. />
                          </DiscreteObjectKeyFrame.Value>
                        </DiscreteObjectKeyFrame>
                      </ObjectAnimationUsingKeyFrames>-->
                      <ObjectAnimationUsingKeyFrames Storyboard.TargetName="ContentPresenter"
                                                     Storyboard.TargetProperty="BorderBrush">
                        <DiscreteObjectKeyFrame KeyTime="0"
                                                Value="{ThemeResource SystemControlHighlightBaseMediumLowBrush}" />
                      </ObjectAnimationUsingKeyFrames>
                      <ObjectAnimationUsingKeyFrames Storyboard.TargetName="ContentPresenter"
                                                     Storyboard.TargetProperty="Foreground">
                        <DiscreteObjectKeyFrame KeyTime="0"
                                                Value="{ThemeResource SystemControlHighlightBaseHighBrush}" />
                      </ObjectAnimationUsingKeyFrames>
                      <PointerUpThemeAnimation Storyboard.TargetName="RootGrid" />
                    </Storyboard>
                  </VisualState>
                  <VisualState x:Name="Pressed">
                    <Storyboard>
                      <ObjectAnimationUsingKeyFrames Storyboard.TargetName="RootGrid"
                                                     Storyboard.TargetProperty="Background">
                        <DiscreteObjectKeyFrame KeyTime="0"
                                                Value="{ThemeResource SystemControlBackgroundBaseMediumLowBrush}" />
                      </ObjectAnimationUsingKeyFrames>
                      <ObjectAnimationUsingKeyFrames Storyboard.TargetName="ContentPresenter"
                                                     Storyboard.TargetProperty="BorderBrush">
                        <DiscreteObjectKeyFrame KeyTime="0"
                                                Value="{ThemeResource SystemControlHighlightTransparentBrush}" />
                      </ObjectAnimationUsingKeyFrames>
                      <ObjectAnimationUsingKeyFrames Storyboard.TargetName="ContentPresenter"
                                                     Storyboard.TargetProperty="Foreground">
                        <DiscreteObjectKeyFrame KeyTime="0"
                                                Value="{ThemeResource SystemControlHighlightBaseHighBrush}" />
                      </ObjectAnimationUsingKeyFrames>
                      <PointerDownThemeAnimation Storyboard.TargetName="RootGrid" />
                    </Storyboard>
                  </VisualState>
                  <VisualState x:Name="Disabled">
                    <Storyboard>
                      <ObjectAnimationUsingKeyFrames Storyboard.TargetName="RootGrid"
                                                     Storyboard.TargetProperty="Background">
                        <DiscreteObjectKeyFrame KeyTime="0"
                                                Value="{ThemeResource SystemControlBackgroundBaseLowBrush}" />
                      </ObjectAnimationUsingKeyFrames>
                      <ObjectAnimationUsingKeyFrames Storyboard.TargetName="ContentPresenter"
                                                     Storyboard.TargetProperty="Foreground">
                        <DiscreteObjectKeyFrame KeyTime="0"
                                                Value="{ThemeResource SystemControlDisabledBaseMediumLowBrush}" />
                      </ObjectAnimationUsingKeyFrames>
                      <ObjectAnimationUsingKeyFrames Storyboard.TargetName="ContentPresenter"
                                                     Storyboard.TargetProperty="BorderBrush">
                        <DiscreteObjectKeyFrame KeyTime="0"
                                                Value="{ThemeResource SystemControlDisabledTransparentBrush}" />
                      </ObjectAnimationUsingKeyFrames>
                    </Storyboard>
                  </VisualState>
                  <VisualState x:Name="Checked">
                    <Storyboard>
                      <!--<ObjectAnimationUsingKeyFrames Storyboard.TargetName="ContentPresenter"
                                                     Storyboard.TargetProperty="Content">
                        <DiscreteObjectKeyFrame KeyTime="0:0:0">
                          <DiscreteObjectKeyFrame.Value>
                            <Image x:Name="PauseCheckedIcon"
                                   ImageFailed="PauseIcon_OnImageFailed"
                                   Source="Assets/play-button_highlight.svg"
                                   Stretch="Uniform" />
                          </DiscreteObjectKeyFrame.Value>
                        </DiscreteObjectKeyFrame>
                      </ObjectAnimationUsingKeyFrames>-->

                      <ObjectAnimationUsingKeyFrames Storyboard.TargetName="RootGrid"
                                                     Storyboard.TargetProperty="Background">
                        <DiscreteObjectKeyFrame KeyTime="0"
                                                Value="{ThemeResource SystemControlHighlightAccentBrush}" />
                      </ObjectAnimationUsingKeyFrames>
                      <ObjectAnimationUsingKeyFrames Storyboard.TargetName="ContentPresenter"
                                                     Storyboard.TargetProperty="Foreground">
                        <DiscreteObjectKeyFrame KeyTime="0"
                                                Value="{ThemeResource SystemControlHighlightAltChromeWhiteBrush}" />
                      </ObjectAnimationUsingKeyFrames>
                      <ObjectAnimationUsingKeyFrames Storyboard.TargetName="ContentPresenter"
                                                     Storyboard.TargetProperty="BorderBrush">
                        <DiscreteObjectKeyFrame KeyTime="0"
                                                Value="{ThemeResource SystemControlHighlightAltTransparentBrush}" />
                      </ObjectAnimationUsingKeyFrames>
                      <PointerUpThemeAnimation Storyboard.TargetName="RootGrid" />
                    </Storyboard>
                  </VisualState>
                  <VisualState x:Name="CheckedPointerOver">
                    <Storyboard>
                      <ObjectAnimationUsingKeyFrames Storyboard.TargetName="ContentPresenter"
                                                     Storyboard.TargetProperty="Content">
                        <DiscreteObjectKeyFrame KeyTime="0:0:0">
                          <DiscreteObjectKeyFrame.Value>
                            <Image x:Name="PausePointerOverCheckedIcon"
                                   Source="/Assets/play-button_highlight.svg"
                                   Stretch="Uniform" />
                          </DiscreteObjectKeyFrame.Value>
                        </DiscreteObjectKeyFrame>
                      </ObjectAnimationUsingKeyFrames>

                      <ObjectAnimationUsingKeyFrames Storyboard.TargetName="RootGrid"
                                                     Storyboard.TargetProperty="Background">
                        <DiscreteObjectKeyFrame KeyTime="0"
                                                Value="{ThemeResource SystemControlHighlightAccentBrush}" />
                      </ObjectAnimationUsingKeyFrames>
                      <ObjectAnimationUsingKeyFrames Storyboard.TargetName="ContentPresenter"
                                                     Storyboard.TargetProperty="BorderBrush">
                        <DiscreteObjectKeyFrame KeyTime="0"
                                                Value="{ThemeResource SystemControlHighlightBaseMediumLowBrush}" />
                      </ObjectAnimationUsingKeyFrames>
                      <ObjectAnimationUsingKeyFrames Storyboard.TargetName="ContentPresenter"
                                                     Storyboard.TargetProperty="Foreground">
                        <DiscreteObjectKeyFrame KeyTime="0"
                                                Value="{ThemeResource SystemControlHighlightAltChromeWhiteBrush}" />
                      </ObjectAnimationUsingKeyFrames>
                      <PointerUpThemeAnimation Storyboard.TargetName="RootGrid" />
                    </Storyboard>
                  </VisualState>
                  <VisualState x:Name="CheckedPressed">
                    <Storyboard>

                      <ObjectAnimationUsingKeyFrames Storyboard.TargetName="RootGrid"
                                                     Storyboard.TargetProperty="Background">
                        <DiscreteObjectKeyFrame KeyTime="0"
                                                Value="{ThemeResource SystemControlHighlightBaseMediumLowBrush}" />
                      </ObjectAnimationUsingKeyFrames>

                      <ObjectAnimationUsingKeyFrames Storyboard.TargetName="ContentPresenter"
                                                     Storyboard.TargetProperty="BorderBrush">
                        <DiscreteObjectKeyFrame KeyTime="0"
                                                Value="Transparent" />
                      </ObjectAnimationUsingKeyFrames>
                      <PointerDownThemeAnimation Storyboard.TargetName="RootGrid" />
                    </Storyboard>
                  </VisualState>
                  <VisualState x:Name="CheckedDisabled">
                    <Storyboard>
                      <ObjectAnimationUsingKeyFrames Storyboard.TargetName="RootGrid"
                                                     Storyboard.TargetProperty="Background">
                        <DiscreteObjectKeyFrame KeyTime="0"
                                                Value="{ThemeResource SystemControlBackgroundBaseLowBrush}" />
                      </ObjectAnimationUsingKeyFrames>
                      <ObjectAnimationUsingKeyFrames Storyboard.TargetName="ContentPresenter"
                                                     Storyboard.TargetProperty="Foreground">
                        <DiscreteObjectKeyFrame KeyTime="0"
                                                Value="{ThemeResource SystemControlDisabledBaseMediumLowBrush}" />
                      </ObjectAnimationUsingKeyFrames>
                      <ObjectAnimationUsingKeyFrames Storyboard.TargetName="ContentPresenter"
                                                     Storyboard.TargetProperty="BorderBrush">
                        <DiscreteObjectKeyFrame KeyTime="0"
                                                Value="{ThemeResource SystemControlDisabledTransparentBrush}" />
                      </ObjectAnimationUsingKeyFrames>
                    </Storyboard>
                  </VisualState>
                  <VisualState x:Name="Indeterminate">
                    <Storyboard>
                      <PointerUpThemeAnimation Storyboard.TargetName="RootGrid" />
                    </Storyboard>
                  </VisualState>
                  <VisualState x:Name="IndeterminatePointerOver">
                    <Storyboard>
                      <ObjectAnimationUsingKeyFrames Storyboard.TargetName="RootGrid"
                                                     Storyboard.TargetProperty="Background">
                        <DiscreteObjectKeyFrame KeyTime="0"
                                                Value="{ThemeResource SystemControlBackgroundBaseLowBrush}" />
                      </ObjectAnimationUsingKeyFrames>
                      <ObjectAnimationUsingKeyFrames Storyboard.TargetName="ContentPresenter"
                                                     Storyboard.TargetProperty="BorderBrush">
                        <DiscreteObjectKeyFrame KeyTime="0"
                                                Value="{ThemeResource SystemControlHighlightBaseMediumLowBrush}" />
                      </ObjectAnimationUsingKeyFrames>
                      <ObjectAnimationUsingKeyFrames Storyboard.TargetName="ContentPresenter"
                                                     Storyboard.TargetProperty="Foreground">
                        <DiscreteObjectKeyFrame KeyTime="0"
                                                Value="{ThemeResource SystemControlHighlightBaseHighBrush}" />
                      </ObjectAnimationUsingKeyFrames>
                      <PointerUpThemeAnimation Storyboard.TargetName="RootGrid" />
                    </Storyboard>
                  </VisualState>
                  <VisualState x:Name="IndeterminatePressed">
                    <Storyboard>
                      <ObjectAnimationUsingKeyFrames Storyboard.TargetName="RootGrid"
                                                     Storyboard.TargetProperty="Background">
                        <DiscreteObjectKeyFrame KeyTime="0"
                                                Value="{ThemeResource SystemControlBackgroundBaseMediumLowBrush}" />
                      </ObjectAnimationUsingKeyFrames>
                      <ObjectAnimationUsingKeyFrames Storyboard.TargetName="ContentPresenter"
                                                     Storyboard.TargetProperty="BorderBrush">
                        <DiscreteObjectKeyFrame KeyTime="0"
                                                Value="{ThemeResource SystemControlHighlightTransparentBrush}" />
                      </ObjectAnimationUsingKeyFrames>
                      <ObjectAnimationUsingKeyFrames Storyboard.TargetName="ContentPresenter"
                                                     Storyboard.TargetProperty="Foreground">
                        <DiscreteObjectKeyFrame KeyTime="0"
                                                Value="{ThemeResource SystemControlHighlightBaseHighBrush}" />
                      </ObjectAnimationUsingKeyFrames>
                      <PointerDownThemeAnimation Storyboard.TargetName="RootGrid" />
                    </Storyboard>
                  </VisualState>
                  <VisualState x:Name="IndeterminateDisabled">
                    <Storyboard>
                      <ObjectAnimationUsingKeyFrames Storyboard.TargetName="RootGrid"
                                                     Storyboard.TargetProperty="Background">
                        <DiscreteObjectKeyFrame KeyTime="0"
                                                Value="{ThemeResource SystemControlBackgroundBaseLowBrush}" />
                      </ObjectAnimationUsingKeyFrames>
                      <ObjectAnimationUsingKeyFrames Storyboard.TargetName="ContentPresenter"
                                                     Storyboard.TargetProperty="Foreground">
                        <DiscreteObjectKeyFrame KeyTime="0"
                                                Value="{ThemeResource SystemControlDisabledBaseMediumLowBrush}" />
                      </ObjectAnimationUsingKeyFrames>
                      <ObjectAnimationUsingKeyFrames Storyboard.TargetName="ContentPresenter"
                                                     Storyboard.TargetProperty="BorderBrush">
                        <DiscreteObjectKeyFrame KeyTime="0"
                                                Value="{ThemeResource SystemControlDisabledTransparentBrush}" />
                      </ObjectAnimationUsingKeyFrames>
                    </Storyboard>
                  </VisualState>
                </VisualStateGroup>
              </VisualStateManager.VisualStateGroups>
              <ContentPresenter x:Name="ContentPresenter"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                Content="{TemplateBinding Content}"
                                ContentTransitions="{TemplateBinding ContentTransitions}"
                                ContentTemplate="{TemplateBinding ContentTemplate}"
                                Padding="{TemplateBinding Padding}"
                                HorizontalContentAlignment="{TemplateBinding HorizontalContentAlignment}"
                                VerticalContentAlignment="{TemplateBinding VerticalContentAlignment}"
                                AutomationProperties.AccessibilityView="Raw" />
            </Grid>
          </ControlTemplate>
        </Setter.Value>
      </Setter>
    </Style>

    <Style TargetType="TextBox">
      <Setter Property="BorderThickness"
              Value="0" />
      <Setter Property="Padding"
              Value="4,0" />
      <Setter Property="IsSpellCheckEnabled"
              Value="False" />
      <!--<Setter Property="PlaceholderText"
              Value="&lt;empty&gt;" />-->
      <Setter Property="Margin"
              Value="0" />
      <Setter Property="Background"
              Value="Transparent" />
      <Setter Property="HorizontalAlignment"
              Value="Left" />
      <Setter Property="VerticalContentAlignment"
              Value="Top" />
      <Setter Property="MinWidth"
              Value="30" />
      <Setter Property="MinHeight"
              Value="0" />
      <Setter Property="Foreground"
              Value="{ThemeResource SystemControlForegroundBaseHighBrush}" />
      <Setter Property="BorderBrush"
              Value="{ThemeResource SystemControlForegroundChromeDisabledLowBrush}" />
      <Setter Property="SelectionHighlightColor"
              Value="{ThemeResource SystemControlHighlightAccentBrush}" />
      <Setter Property="FontFamily"
              Value="{ThemeResource ContentControlThemeFontFamily}" />
      <Setter Property="FontSize"
              Value="{ThemeResource ControlContentThemeFontSize}" />
      <Setter Property="ScrollViewer.HorizontalScrollMode"
              Value="Auto" />
      <Setter Property="ScrollViewer.VerticalScrollMode"
              Value="Auto" />
      <Setter Property="ScrollViewer.HorizontalScrollBarVisibility"
              Value="Hidden" />
      <Setter Property="ScrollViewer.VerticalScrollBarVisibility"
              Value="Hidden" />
      <Setter Property="ScrollViewer.IsDeferredScrollingEnabled"
              Value="False" />
      <Setter Property="Template">
        <Setter.Value>
          <ControlTemplate TargetType="TextBox">
            <Grid>
              <Grid.Resources>
                <Style x:Name="DeleteButtonStyle"
                       TargetType="Button">
                  <Setter Property="Template">
                    <Setter.Value>
                      <ControlTemplate TargetType="Button">
                        <Grid x:Name="ButtonLayoutGrid"
                              BorderBrush="{ThemeResource TextBoxButtonBorderThemeBrush}"
                              BorderThickness="{TemplateBinding BorderThickness}"
                              Background="{ThemeResource TextBoxButtonBackgroundThemeBrush}">
                          <VisualStateManager.VisualStateGroups>
                            <VisualStateGroup x:Name="CommonStates">
                              <VisualState x:Name="Normal" />
                              <VisualState x:Name="PointerOver">
                                <Storyboard>
                                  <ObjectAnimationUsingKeyFrames Storyboard.TargetName="GlyphElement"
                                                                 Storyboard.TargetProperty="Foreground">
                                    <DiscreteObjectKeyFrame KeyTime="0"
                                                            Value="{ThemeResource SystemControlHighlightAccentBrush}" />
                                  </ObjectAnimationUsingKeyFrames>
                                </Storyboard>
                              </VisualState>
                              <VisualState x:Name="Pressed">
                                <Storyboard>
                                  <ObjectAnimationUsingKeyFrames Storyboard.TargetName="ButtonLayoutGrid"
                                                                 Storyboard.TargetProperty="Background">
                                    <DiscreteObjectKeyFrame KeyTime="0"
                                                            Value="{ThemeResource SystemControlHighlightAccentBrush}" />
                                  </ObjectAnimationUsingKeyFrames>
                                  <ObjectAnimationUsingKeyFrames Storyboard.TargetName="GlyphElement"
                                                                 Storyboard.TargetProperty="Foreground">
                                    <DiscreteObjectKeyFrame KeyTime="0"
                                                            Value="{ThemeResource SystemControlHighlightAltChromeWhiteBrush}" />
                                  </ObjectAnimationUsingKeyFrames>
                                </Storyboard>
                              </VisualState>
                              <VisualState x:Name="Disabled">
                                <Storyboard>
                                  <DoubleAnimation Storyboard.TargetName="ButtonLayoutGrid"
                                                   Storyboard.TargetProperty="Opacity"
                                                   To="0"
                                                   Duration="0" />
                                </Storyboard>
                              </VisualState>
                            </VisualStateGroup>
                          </VisualStateManager.VisualStateGroups>
                          <TextBlock x:Name="GlyphElement"
                                     Foreground="{ThemeResource SystemControlForegroundChromeBlackMediumBrush}"
                                     VerticalAlignment="Center"
                                     HorizontalAlignment="Center"
                                     FontStyle="Normal"
                                     FontSize="12"
                                     Text="&#xE10A;"
                                     FontFamily="{ThemeResource SymbolThemeFontFamily}"
                                     AutomationProperties.AccessibilityView="Raw" />
                        </Grid>
                      </ControlTemplate>
                    </Setter.Value>
                  </Setter>
                </Style>
              </Grid.Resources>
              <VisualStateManager.VisualStateGroups>
                <VisualStateGroup x:Name="CommonStates">
                  <VisualState x:Name="Disabled">
                    <Storyboard>
                      <ObjectAnimationUsingKeyFrames Storyboard.TargetName="HeaderContentPresenter"
                                                     Storyboard.TargetProperty="Foreground">
                        <DiscreteObjectKeyFrame KeyTime="0"
                                                Value="{ThemeResource SystemControlDisabledBaseMediumLowBrush}" />
                      </ObjectAnimationUsingKeyFrames>
                      <ObjectAnimationUsingKeyFrames Storyboard.TargetName="BackgroundElement"
                                                     Storyboard.TargetProperty="Background">
                        <DiscreteObjectKeyFrame KeyTime="0"
                                                Value="{ThemeResource SystemControlDisabledTransparentBrush}" />
                      </ObjectAnimationUsingKeyFrames>
                      <ObjectAnimationUsingKeyFrames Storyboard.TargetName="BorderElement"
                                                     Storyboard.TargetProperty="Background">
                        <DiscreteObjectKeyFrame KeyTime="0"
                                                Value="{ThemeResource SystemControlBackgroundBaseLowBrush}" />
                      </ObjectAnimationUsingKeyFrames>
                      <ObjectAnimationUsingKeyFrames Storyboard.TargetName="BorderElement"
                                                     Storyboard.TargetProperty="BorderBrush">
                        <DiscreteObjectKeyFrame KeyTime="0"
                                                Value="{ThemeResource SystemControlDisabledBaseLowBrush}" />
                      </ObjectAnimationUsingKeyFrames>
                      <ObjectAnimationUsingKeyFrames Storyboard.TargetName="ContentElement"
                                                     Storyboard.TargetProperty="Foreground">
                        <DiscreteObjectKeyFrame KeyTime="0"
                                                Value="{ThemeResource SystemControlDisabledChromeDisabledLowBrush}" />
                      </ObjectAnimationUsingKeyFrames>
                      <ObjectAnimationUsingKeyFrames Storyboard.TargetName="PlaceholderTextContentPresenter"
                                                     Storyboard.TargetProperty="Foreground">
                        <DiscreteObjectKeyFrame KeyTime="0"
                                                Value="{ThemeResource SystemControlDisabledChromeDisabledLowBrush}" />
                      </ObjectAnimationUsingKeyFrames>
                    </Storyboard>
                  </VisualState>
                  <VisualState x:Name="Normal" />
                  <VisualState x:Name="PointerOver">
                    <Storyboard>
                      <ObjectAnimationUsingKeyFrames Storyboard.TargetName="BorderElement"
                                                     Storyboard.TargetProperty="BorderThickness">
                        <DiscreteObjectKeyFrame KeyTime="0"
                                                Value="1" />
                      </ObjectAnimationUsingKeyFrames>
                      <ObjectAnimationUsingKeyFrames Storyboard.TargetName="BorderElement"
                                                     Storyboard.TargetProperty="BorderBrush">
                        <DiscreteObjectKeyFrame KeyTime="0"
                                                Value="{ThemeResource SystemControlHighlightChromeAltLowBrush}" />
                      </ObjectAnimationUsingKeyFrames>
                      <ObjectAnimationUsingKeyFrames Storyboard.TargetName="BackgroundElement"
                                                     Storyboard.TargetProperty="Opacity">
                        <DiscreteObjectKeyFrame KeyTime="0"
                                                Value="{ThemeResource TextControlBackgroundHoverOpacity}" />
                      </ObjectAnimationUsingKeyFrames>
                    </Storyboard>
                  </VisualState>
                  <VisualState x:Name="Focused">
                    <Storyboard>
                      <ObjectAnimationUsingKeyFrames Storyboard.TargetName="PlaceholderTextContentPresenter"
                                                     Storyboard.TargetProperty="Foreground">
                        <DiscreteObjectKeyFrame KeyTime="0"
                                                Value="{ThemeResource SystemControlPageTextChromeBlackMediumLowBrush}" />
                      </ObjectAnimationUsingKeyFrames>
                      <ObjectAnimationUsingKeyFrames Storyboard.TargetName="BackgroundElement"
                                                     Storyboard.TargetProperty="Background">
                        <DiscreteObjectKeyFrame KeyTime="0"
                                                Value="{ThemeResource SystemControlBackgroundChromeWhiteBrush}" />
                      </ObjectAnimationUsingKeyFrames>
                      <ObjectAnimationUsingKeyFrames Storyboard.TargetName="BackgroundElement"
                                                     Storyboard.TargetProperty="Opacity">
                        <DiscreteObjectKeyFrame KeyTime="0"
                                                Value="{ThemeResource TextControlBackgroundFocusedOpacity}" />
                      </ObjectAnimationUsingKeyFrames>
                      <ObjectAnimationUsingKeyFrames Storyboard.TargetName="BorderElement"
                                                     Storyboard.TargetProperty="BorderBrush">
                        <DiscreteObjectKeyFrame KeyTime="0"
                                                Value="{ThemeResource SystemControlHighlightAccentBrush}" />
                      </ObjectAnimationUsingKeyFrames>
                      <ObjectAnimationUsingKeyFrames Storyboard.TargetName="ContentElement"
                                                     Storyboard.TargetProperty="Foreground">
                        <DiscreteObjectKeyFrame KeyTime="0"
                                                Value="{ThemeResource SystemControlForegroundChromeBlackHighBrush}" />
                      </ObjectAnimationUsingKeyFrames>
                      <ObjectAnimationUsingKeyFrames Storyboard.TargetName="ContentElement"
                                                     Storyboard.TargetProperty="RequestedTheme">
                        <DiscreteObjectKeyFrame KeyTime="0"
                                                Value="Light" />
                      </ObjectAnimationUsingKeyFrames>
                    </Storyboard>
                  </VisualState>
                </VisualStateGroup>
                <VisualStateGroup x:Name="ButtonStates">
                  <VisualState x:Name="ButtonVisible">
                    <Storyboard>
                      <ObjectAnimationUsingKeyFrames Storyboard.TargetName="DeleteButton"
                                                     Storyboard.TargetProperty="Visibility">
                        <DiscreteObjectKeyFrame KeyTime="0">
                          <DiscreteObjectKeyFrame.Value>
                            <Visibility>Visible</Visibility>
                          </DiscreteObjectKeyFrame.Value>
                        </DiscreteObjectKeyFrame>
                      </ObjectAnimationUsingKeyFrames>
                    </Storyboard>
                  </VisualState>
                  <VisualState x:Name="ButtonCollapsed" />
                </VisualStateGroup>
              </VisualStateManager.VisualStateGroups>
              <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
              </Grid.ColumnDefinitions>
              <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
              </Grid.RowDefinitions>
              <Border x:Name="BackgroundElement"
                      Grid.Row="1"
                      Background="{TemplateBinding Background}"
                      Margin="{TemplateBinding BorderThickness}"
                      Opacity="{ThemeResource TextControlBackgroundRestOpacity}"
                      Grid.ColumnSpan="2"
                      Grid.RowSpan="1" />
              <Border x:Name="BorderElement"
                      Grid.Row="1"
                      Grid.Column="0"
                      BorderBrush="{TemplateBinding BorderBrush}"
                      BorderThickness="{TemplateBinding BorderThickness}"
                      Grid.ColumnSpan="2"
                      Grid.RowSpan="1" />
              <ContentPresenter x:Name="HeaderContentPresenter"
                                x:DeferLoadStrategy="Lazy"
                                Visibility="Collapsed"
                                Grid.Row="0"
                                Grid.Column="0"
                                Foreground="{ThemeResource SystemControlForegroundBaseHighBrush}"
                                Margin="0,0,0,8"
                                Grid.ColumnSpan="2"
                                Content="{TemplateBinding Header}"
                                ContentTemplate="{TemplateBinding HeaderTemplate}"
                                FontWeight="Normal" />
              <ScrollViewer x:Name="ContentElement"
                            Grid.Row="1"
                            HorizontalScrollMode="{TemplateBinding ScrollViewer.HorizontalScrollMode}"
                            HorizontalScrollBarVisibility="{TemplateBinding ScrollViewer.HorizontalScrollBarVisibility}"
                            VerticalScrollMode="{TemplateBinding ScrollViewer.VerticalScrollMode}"
                            VerticalScrollBarVisibility="{TemplateBinding ScrollViewer.VerticalScrollBarVisibility}"
                            IsHorizontalRailEnabled="{TemplateBinding ScrollViewer.IsHorizontalRailEnabled}"
                            IsVerticalRailEnabled="{TemplateBinding ScrollViewer.IsVerticalRailEnabled}"
                            IsDeferredScrollingEnabled="{TemplateBinding ScrollViewer.IsDeferredScrollingEnabled}"
                            Margin="{TemplateBinding BorderThickness}"
                            Padding="{TemplateBinding Padding}"
                            IsTabStop="False"
                            AutomationProperties.AccessibilityView="Raw"
                            ZoomMode="Disabled" />
              <ContentControl x:Name="PlaceholderTextContentPresenter"
                              Grid.Row="1"
                              Grid.Column="0" 
                              Foreground="{ThemeResource SystemControlPageTextBaseMediumBrush}"
                              Margin="{TemplateBinding BorderThickness}"
                              Padding="{TemplateBinding Padding}"
                              IsTabStop="False"
                              Grid.ColumnSpan="2"
                              Content="{TemplateBinding PlaceholderText}"
                              IsHitTestVisible="False" />
              <Button x:Name="DeleteButton"
                      Grid.Row="1"
                      Style="{StaticResource DeleteButtonStyle}"
                      BorderThickness="{TemplateBinding BorderThickness}"
                      Margin="{ThemeResource HelperButtonThemePadding}"
                      IsTabStop="False"
                      Grid.Column="1"
                      Visibility="Collapsed"
                      FontSize="{TemplateBinding FontSize}"
                      MinWidth="34"
                      VerticalAlignment="Stretch" />
            </Grid>
          </ControlTemplate>
        </Setter.Value>
      </Setter>
    </Style>

  </Page.Resources>


  <Grid Background="Transparent">
    <Grid.RowDefinitions>
      <RowDefinition Height="*" />
      <!--<RowDefinition Height="Auto" />-->
    </Grid.RowDefinitions>
    <ListView Grid.Row="0"
              x:Name="PlaybackListView"
              Margin="0,0,0,48"
              ItemsSource="{Binding Playlist, Mode=OneWay}"
              IsMultiSelectCheckBoxEnabled="True"
              CanReorderItems="True"
              AllowDrop="True"
              IsSwipeEnabled="True"
              ItemContainerStyle="{ThemeResource DefaultPlaylistItemStyle}"
              ItemTemplateSelector="{StaticResource PlaylistTemplateSelector}"
              HorizontalAlignment="Stretch"
              HorizontalContentAlignment="Stretch"
              IsItemClickEnabled="False"
              ItemClick="HandlePlayback_OnItemClick"
              ScrollViewer.VerticalScrollBarVisibility="Auto"
              ScrollViewer.HorizontalScrollBarVisibility="Auto">
    </ListView>
  </Grid>

  <Page.BottomAppBar>
    <CommandBar x:Name="TimerCommandBar" Height="56" Style="{StaticResource CustomCommandBarStyle}">

      <CommandBar.Content>
        <Grid>
          <Grid Background="{ThemeResource SystemControlBackgroundChromeMediumBrush}"
                Padding="126,0,0,0">
            <Grid.ColumnDefinitions>
              <ColumnDefinition Width="*" />
              <ColumnDefinition Width="*" />
              <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>

            <StackPanel Grid.Column="0"
                        Orientation="Horizontal">
              <StackPanel Margin="0,4,0,0"
                          VerticalAlignment="Stretch">
                <TextBlock Text="{Binding LastPlayedFile.Tag.Album, Mode=OneWay}"
                           Visibility="{Binding RelativeSource={RelativeSource Self}, Path=Text, Converter={StaticResource TextBlockTextToVisibilityConverter}}"
                           Margin="0,0,0,0"
                           CharacterSpacing="120"
                           ToolTipService.ToolTip="Album"
                           MinHeight="0"
                           FontSize="14"
                           FontFamily="Book Antiqua"
                           FontWeight="SemiBold"
                           FontStyle="Normal"
                           FontStretch="UltraExpanded" />
                <TextBlock Text="{Binding LastPlayedFile.Tag.AlbumArtist, Mode=OneWay}"
                           Visibility="{Binding RelativeSource={RelativeSource Self}, Path=Text, Converter={StaticResource TextBlockTextToVisibilityConverter}}"
                           ToolTipService.ToolTip="Album Artist"
                           FontSize="11"
                           FontFamily="Calibri Light"
                           FontWeight="Thin"
                           CharacterSpacing="200"
                           FontStyle="Italic"
                           MinHeight="0"
                           FontStretch="UltraExpanded"
                           Margin="0,-2,0,2" />
                <TextBlock Text="{Binding LastPlayedFile.Tag.Title, Mode=OneWay}"
                           Visibility="{Binding RelativeSource={RelativeSource Self}, Path=Text, Converter={StaticResource TextBlockTextToVisibilityConverter}}"
                           ToolTipService.ToolTip="Title"
                           FontSize="14"
                           FontFamily="Calibri Light"
                           CharacterSpacing="50"
                           FontWeight="Thin"
                           FontStretch="UltraExpanded"
                           Margin="0,0,0,0" />
              </StackPanel>
            </StackPanel>


            <CommandBar Grid.Column="1"
                        Margin="0,0,0,0"
                        VerticalAlignment="Center">
              <AppBarToggleButton x:Name="LastPlayedPlaybackButton"
                                  Width="48"
                                  Height="48"
                                  VerticalAlignment="Bottom"
                                  IsCompact="True"
                                  Click="PlayFile"
                                  Label="Play"
                                  IsChecked="{Binding LastPlayedFile.IsPlaying, Mode=TwoWay}"
                                  CommandParameter="{Binding LastPlayedFile, Mode=OneWay}"
                                  Icon="{Binding Source={StaticResource MainPageViewModel}, Path=LastPlayedFile.IsPlaying, Converter={StaticResource PlayImageToggleConverter}, Mode=OneWay}" />

              <AppBarButton Label="Stop"
                            Click="StopFile"
                            Width="48"
                            Height="48"
                            VerticalAlignment="Bottom"
                            IsCompact="True"
                            CommandParameter="{Binding LastPlayedFile, Mode=OneWay}"
                            Icon="Stop" />

              <AppBarButton Label="Previous"
                            Width="48"
                            Height="48"
                            VerticalAlignment="Bottom"
                            IsCompact="True"
                            Margin="32,0,0,0"
                            Click="SkipFileBack"
                            CommandParameter="{Binding LastPlayedFile, Mode=OneWay}"
                            Icon="Previous" />

              <AppBarButton Label="Next"
                            Width="48"
                            Height="48"
                            VerticalAlignment="Bottom"
                            IsCompact="True"
                            Click="SkipFileForward"
                            CommandParameter="{Binding LastPlayedFile, Mode=OneWay}"
                            Icon="Next" />

              <AppBarSeparator />

              <AppBarButton Label="Volume"
                            Margin="0,0,0,0"
                            Width="48"
                            Height="48"
                            VerticalAlignment="Bottom"
                            IsCompact="True"
                            Icon="{Binding LastPlayedFile.Volume, Converter={StaticResource VolumeImageToggleConverter}, Mode=OneWay}">
                <AppBarButton.Flyout>
                  <Flyout>
                    <StackPanel Orientation="Horizontal">

                      <CommandBar Padding="0"
                                  Background="Transparent"
                                  OverflowButtonVisibility="Collapsed">
                        <AppBarToggleButton Label="Volume"
                                            Width="48"
                                            IsChecked="{x:Bind ViewModel.LastPlayedFile.IsMuted, Mode=TwoWay}"
                                            Icon="{Binding LastPlayedFile.Volume, Converter={StaticResource VolumeImageToggleConverter}, Mode=OneWay}" />
                      </CommandBar>
                      <controls:Slider Maximum="1.0"
                              Value="{Binding LastPlayedFile.Volume, Mode=TwoWay}"
                              Minimum="0.0"
                              StepFrequency="0.01"
                              TickFrequency="0.25"
                              TickPlacement="Outside"
                              ThumbToolTipValueConverter="{StaticResource PercentageFormatConverter}"
                              Margin="8,8,16,0"
                              Width="200"
                              Padding="0"
                              Height="Auto"
                              VerticalAlignment="Center" />
                    </StackPanel>
                  </Flyout>
                </AppBarButton.Flyout>
              </AppBarButton>
            </CommandBar>

            <StackPanel Grid.Column="2" VerticalAlignment="Center"
                        HorizontalAlignment="Right" Orientation="Horizontal"
                        Margin="0,0,0,0">
              <StackPanel>
                <TextBlock HorizontalAlignment="Right"
                           HorizontalTextAlignment="Right"
                           Margin="0,0,16,0"
                           Visibility="{Binding IsSleepTimerEnabled, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}"
                           Text="time to sleep"
                           FontSize="11"
                           CharacterSpacing="160"
                           FontFamily="Calibri Light"
                           FontWeight="Thin"
                           FontStretch="UltraExpanded" />
                <TextBlock HorizontalAlignment="Right"
                           MinWidth="104"
                           Margin="0,0,16,0"
                           HorizontalTextAlignment="Justify"
                           Visibility="{Binding IsSleepTimerEnabled, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}"
                           Text="{x:Bind ViewModel.RemainingTimeUntilSleep, Mode=OneWay, Converter={StaticResource TimeSpanToStringFormatConverter}, ConverterParameter=verbose-}"
                           ToolTipService.ToolTip="Time left until sleep"
                           FontSize="16"
                           FontFamily="Calibri Light"
                           FontWeight="Thin"
                           FontStretch="UltraExpanded"
                           Foreground="{ThemeResource SystemControlForegroundAccentBrush}" />
              </StackPanel>

              <CommandBar Margin="0,0,0,0">
                <AppBarToggleButton IsCompact="True"
                              Height="48"
                              Width="48"
                              Label="Playlist Loop"
                              IsChecked="{Binding IsPlaylistLoopEnabled, Mode=TwoWay}"
                              Foreground="{ThemeResource SystemControlForegroundAccentBrush}" />
                <AppBarButton IsCompact="True"
                              Height="48"
                              Width="48"
                              Label="Sleep Timer"
                              Foreground="{ThemeResource SystemControlForegroundAccentBrush}">
                  <AppBarButton.Icon>
                    <FontIcon FontFamily="{StaticResource SymbolThemeFontFamily}"
                              Glyph="&#xE916;"
                              Foreground="{Binding IsSleepTimerEnabled, Converter={StaticResource BooleanToColorConverter}}" />
                  </AppBarButton.Icon>
                  <AppBarButton.Flyout>
                    <Flyout Placement="Top">
                      <StackPanel>
                        <ToggleSwitch x:Name="SleepTimerToggleSwitch"
                                      Header="Sleep Timer"
                                      OnContent="Enabled"
                                      OffContent="Disabled" 
                                      Toggled="ToggleSleepTimer_OnToggled"
                                      IsOn="{Binding IsSleepTimerEnabled, Mode=TwoWay}" />
                        <CheckBox IsEnabled="{x:Bind SleepTimerToggleSwitch.IsOn, Mode=OneWay}"
                                  Content="Auto Start Sleep Timer"
                                  IsChecked="{Binding IsSleepTimerAutoStartEnabled, Mode=TwoWay}" />
                        <TextBlock Text="Mode"
                                   Margin="0,8,0,0" />
                        <RadioButton Content="Countdown"
                                     IsChecked="{Binding IsSleepTimerInCountdownMode, Mode=TwoWay}"
                                     IsEnabled="{x:Bind SleepTimerToggleSwitch.IsOn, Mode=OneWay}" />
                        <RadioButton Content="Clock"
                                     IsEnabled="{x:Bind SleepTimerToggleSwitch.IsOn, Mode=OneWay}" />
                        <TimePicker IsEnabled="{x:Bind SleepTimerToggleSwitch.IsOn, Mode=OneWay}"
                                    ClockIdentifier="24HourClock"
                                    Header="Set Sleep Time"
                                    Time="{Binding SleepTime, Mode=TwoWay}"
                                    Margin="0,8,0,8" />
                      </StackPanel>
                    </Flyout>
                  </AppBarButton.Flyout>
                </AppBarButton>
              </CommandBar>
            </StackPanel>
          </Grid>
        <Border HorizontalAlignment="Left" 
                BorderBrush="{ThemeResource SystemControlBackgroundChromeMediumBrush}"
                BorderThickness="2"
                Margin="8,-44,0,0">
          <Image Stretch="UniformToFill"
                 Height="96" Width="96"
                 VerticalAlignment="Top"
                 Source="{Binding LastPlayedFile.Tag.CoverArt, Mode=OneWay}" />
        </Border></Grid>
      </CommandBar.Content>
    </CommandBar>
  </Page.BottomAppBar>
</Page>